---
title: "Guide d’utilisateur app"
author: "wilfried Dossou-Yovo"
date: '2022-08-09'
output:
  pdf_document:
    toc: yes
  word_document: default
  pdf_doc ument: default
  html_document: 
    toc: yes
    fig_height: 4
    df_print: kable
---
```{r eval=FALSE, include=FALSE}
tinytex:::install_prebuilt()
```

# I.	Étapes
1.	Télécharger le `Template`
2.	Remplir le `template` avec les données des champs
3.	Uploader le `template` rempli dans l’application
4.	Choisir un id dans `Choose field id` et Cliquer sur `update data`
5.	Cliquer `optimize yield 2022`, ensuite contrôler chaque fertilisant avec les boutons ex : `optimise N` et `update N fertilizer` 
6.	Cliquer sur `save predictions` pour enregistrer les prédictions
7.	Télécharger les prédictions dans l’onglet `Saved predictions`
8.	Utiliser le bouton `reset parameters` pour réinitialiser les paramètres et choisir un autre champ par le filtre `Choose field id` 

# II.	Utilisation du template
Le `Template` est un fichier csv à séparateur décimal `,`  `ex: 0,01`  et séparateur de colonne `;`

1.	id : `id` est l’identifiant unique pour le choix des champs, ne peut pas contenir de répétitions, idéalement `1, 2, 3, …., n`
2.	id champs : Le nom du champ
3.	regie : **biologique** ou **conventionnelle**
4.	type de sol :**organique** ou **sable**

-	Indices climatiques du 01 mai au 31 octobre: Données recueillies sur [environnement canada.](https://meteo.gc.ca/mainmenu/weather_menu_f.html) 
5.	temp moy saisonale : temperature moyenne   
Station LEMIEUX altitude 97,20 m  
Station NORMANDIN altitude 137,20 m  
Station SAINT-GERMAIN-DE-GRANTHAM altitude 85 m  
Station L'ASSOMPTION altitude 21 m  
Station SHAWINIGAN altitude 121,90 m  
Station GAGETOWN AWOS A altitude 50,60 m  
Station THUNDER BAY CS altitude 199,40 m  
6.	precip total saisonale: precipitation totale  
7.	nbr de jour de gel saisonale : nombre de jour où on observe une température inférieur à 5 degrée C  
8.	purete (%) : valeur comprise entre 0 – 1

# III. Statistique descriptive du jeu de donnée
## III-1. Sommaire
Ce sommaire donne une idée sur la distribution des données. L'algorithme ne s'attend pas à des valeurs hors context. Par exemple pour l'analyse foliaire en azote, le jeu de donnée présente une valeur minimale de 0,01 et un maximum de 7,8. Si vous rentrez une valeur de 40 cela pourrait empecher l'optimisation. De la meme façon s'il y a trop de `zéro(0)` apres le décimal par rapport a la normale d'une variable `ex pour l'azote foliaire, N_fol(%) = 0,00001`, cela pourrait aussi empecher l'optimisation. Si vous remarquez que l'optimisation ne réagie pas, cela pourrait signifier qu'il y a une variable qui a été mal rentrée. Notons qu'une valeur peut sembler anormale par rapport à la distribution des données `mais cela ne veut pas necessairement dire que c'une valeur aberrante`

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
data <- readRDS("Data/data_fol_sol_imp_app.rds")
```
## III-2. Boxplot analyse de sol(ppm) au printemps de l’année de prédiction

```{r echo=FALSE}
ggplotly(
  data |>
    pivot_longer(cols = contains("Fol"), names_to = "Fol", values_to = "Donnee_Fol") |>
    ggplot(aes(x = Fol, y = Donnee_Fol)) +
    geom_boxplot() +
    labs(x = NULL, y = "Valeur") +
    theme_bw() +
    theme(axis.text.x = element_text(vjust = 0.5,
                                     angle = 50))
)
```

## III-3. Boxplot analyse foliaire(%) année précédante

```{r echo=FALSE}
ggplotly(
  data |>
    pivot_longer(cols = contains("sol"), names_to = "Sol", values_to = "Donnee_Sol") |>
    ggplot(aes(x = Sol, y = Donnee_Sol)) +
    geom_boxplot() +
    labs(x = NULL, y = "Valeur") +
    theme_bw() +
    theme(axis.text.x = element_text(vjust = 0.5,
                                     angle = 50))
)
```

## III-4. Histogrammes
### Analyse foliaire en pourcentage
```{r echo=FALSE}
hist_fn <- function(x, xlab, xname){
   ggplotly(  
  ggplot() +
  geom_histogram(aes(x), bins = 300) +
    labs(x = xlab, y="Effectif", title = xname) +
    theme_bw()
)
}

hist_fn(data$`N_Fol (%)`, "N_Fol (%)", "Azote")
hist_fn(data$`P_Fol (%)`, "P_Fol (%)", "Phosphore")
hist_fn(data$`K_Fol (%)`, "K_Fol (%)", "Potassium")
hist_fn(data$`Ca_Fol (%)`, "Ca_Fol (%)", "Calcium")
hist_fn(data$`Cu_Fol (%)`, "Mg_Fol (%)", "Cuivre")
hist_fn(data$`B_Fol (%)`, "B_Fol (%)", "Bore")
hist_fn(data$`Fe_Fol (%)`, "Fe_Fol (%)", "Fer")
hist_fn(data$`Zn_Fol (%)`, "Zn_Fol (%)", "Zinc")
hist_fn(data$`Al_Fol (%)`, "Al_Fol (%)", "Aluminium")
hist_fn(data$`Mg_Sol (ppm)`, "Mg_Fol (%)", "Magnésium")
hist_fn(data$`Mn_Fol (%)`, "Mn_Fol (%)", "Manganèse")
```


### Analyse de sol en ppm
```{r echo=FALSE}
hist_fn(data$`Ca_Sol (ppm)`, "Ca_Fol (ppm)", "Calcium")
hist_fn(data$`P_Sol (ppm)`, "P_Fol (ppm)", "Phosphore")
hist_fn(data$`K_Sol (ppm)`, "K_Fol (ppm)", "Potassium")
hist_fn(data$`Mg_Sol (ppm)`, "Mg_Fol (ppm)", "Magnésium")
hist_fn(data$`Cu_Sol (ppm)`, "Cu_Fol (ppm)", "Cuivre")
hist_fn(data$`B_Sol (ppm)`, "B_Fol (ppm)", "Bore")
hist_fn(data$`Zn_Sol (ppm)`, "Zn_Fol (ppm)", "Zinc")
hist_fn(data$`Fe_Sol (ppm)`, "Fe_Fol (ppm)", "Fer")
hist_fn(data$`Al_Sol (ppm)`, "Al_Fol (ppm)", "Aluminium")
```









